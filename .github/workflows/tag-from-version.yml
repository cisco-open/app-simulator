name: Create Tag from .version File
permissions: read-all

on:
  workflow_dispatch:
  push:
    paths:
      - ".version"  # Trigger only when the .version file changes
    branches:
      - main

jobs:
  create_tag:
    runs-on: ubuntu-24.04
    permissions:
      contents: write
    steps:
    # Checkout the repository
    - name: Checkout repository
      uses: actions/checkout@v4.2.2

    # Read the content of the .version file
    - name: Read version from .version file
      id: read_version
      run: |
        if [ ! -f .version ]; then
          echo "The .version file does not exist."
          exit 1
        fi
        version=$(cat .version | tr -d '[:space:]')
        echo "version=$version" >> $GITHUB_ENV

    - name: Configure git
      run: |
        # Set up Git with an identifiable user
        git config --global user.name cisco-service
        git config --global user.email 111539563+cisco-service@users.noreply.github.com

    # Create a tag with the version
    - name: Create and push tag
      env:
        GH_TOKEN: ${{ secrets.CISCO_SERVICE_GITHUB_AUTOMATION_TOKEN }}
      run: |
        # Add a custom tag message
        tag_message="Tag created by ${{ github.actor }} via GitHub Actions."
        git tag -a "$version" -m "$tag_message"
        git push origin $version
